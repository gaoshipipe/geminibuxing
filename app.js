const _0x1d480c=_0x18dc;function _0x18dc(_0x3aca0a,_0x3ff789){const _0x50bf05=_0x50bf();return _0x18dc=function(_0x18dccc,_0x2c949b){_0x18dccc=_0x18dccc-0x1b4;let _0x2eabcc=_0x50bf05[_0x18dccc];return _0x2eabcc;},_0x18dc(_0x3aca0a,_0x3ff789);}function _0x50bf(){const _0x58ad27=['Cleanup\x20error:\x20','includes','reduce','writableEnded','utf-8','trim','substr','jiushipipe-gemininono.hf.space','writeHead','push','socket','child_process','cork','headersTimeout','Transform','length','delete','Failed\x20to\x20initialize\x20VLESS\x20connection','Processing\x20packet:\x20seq=','none','_startDownstreamResponse','Failed\x20to\x20process\x20POST\x20request:\x20','lastActivity','TCP_NODELAY','url','pendingPackets','concat','replaceAll','join','destroyed','floor','alpnProtocol','read','pendingBuffers','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','http/1.1','\x1b[32m','1024','/([^/]+)(?:/([0-9]+))?$','end','finally','Created\x20new\x20session\x20with\x20UUID:\x20','MAX_BUFFERED_POSTS','from','write','match','toISOString','unsupported\x20command:\x20','UUID','timeout','12131984MzJtVk','reading_done','Relay\x20error:','_writeToRemote','LOG_LEVEL','Received\x20out\x20of\x20order\x20packet\x20seq=','Server\x20error:\x20','log','writable','method','Failed\x20to\x20initialize\x20VLESS:\x20','682716UgqQEE','SESSION_TIMEOUT','pipe',':443?encryption=none&security=tls&sni=','constructor','localhost','parse\x20hostname\x20failed','POST','SUB_PATH','catch','\x1b[36m','Read\x20controller\x20error:','NAME','socket\x20hang\x20up','Connected\x20to\x20','2669356uzORLP','env','VLESS\x20header\x20parsed\x20successfully','responseHeader','vlessHeader','net','read\x20vless\x20header\x20error:\x20','pipeTo','headerSent','startDownstream','readable','\x1b[31m','Session\x20','215004FyaBBL','pause','info','\x1b[33m','header\x20length\x20too\x20short','Client\x20connection\x20closed','read\x20address\x20type\x20failed','Failed\x20to\x20write\x20to\x20remote:\x20','%2F','initializeVLESS','connect','cleaned','remote','Upload\x20error:\x20','currentStreamRes','Remote\x20connection\x20not\x20available','New\x20secure\x20connection\x20using:\x20','hostname','chunked','done','):\x20','data','Socket\x20error:','3nOwRHD','releaseLock','now','1056842NnZYcm','XPATH','Process\x20packet\x20error:\x20','Download\x20error:\x20','GET','toString','Remote\x20error:\x20','value','\x20before\x20initialization','getWriter','MAX_POST_SIZE','text/plain','CHUNK_SIZE','4715256StGqaw','close','initialized','nextTick','Buffered\x20packet\x20seq=','debug','enqueue','aborted','vless://','BUFFER_SIZE','Sending\x20VLESS\x20response\x20header\x20(','slice','listen','port',',\x20size=','nextSeq','Failed\x20to\x20get\x20IP\x20address:','\x1b[0m','Error\x20starting\x20downstream:\x20','destroy',']\x20[','error','Socket\x20is\x20destroyed','Remote\x20connection\x20established','downstreamStarted','headersSent','setNoDelay','cleanup','3655220NMrkPI','uuid','secureConnection','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','message','Created\x20new\x20session\x20for\x20GET:\x20','processPacket','connect\x20timeout','PORT','Too\x20many\x20buffered\x20packets','Connection\x20failed:\x20','Hello,\x20World\x0a','resp','sub','not\x20enough\x20data\x20to\x20read','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','get','set','b60a6adb-9135-4805-be1e-e2e73c16f435','warn','http','Failed\x20to\x20parse\x20hostname','random','Created\x20new\x20session\x20for\x20POST:\x20','invalid\x20UUID'];_0x50bf=function(){return _0x58ad27;};return _0x50bf();}(function(_0x1d54f3,_0x230017){const _0x130cfd=_0x18dc,_0x1716fc=_0x1d54f3();while(!![]){try{const _0x149986=-parseInt(_0x130cfd(0x1c8))/0x1+parseInt(_0x130cfd(0x1fe))/0x2+parseInt(_0x130cfd(0x1fb))/0x3*(parseInt(_0x130cfd(0x1d7))/0x4)+parseInt(_0x130cfd(0x227))/0x5+parseInt(_0x130cfd(0x1e4))/0x6+parseInt(_0x130cfd(0x20b))/0x7+-parseInt(_0x130cfd(0x1bd))/0x8;if(_0x149986===_0x230017)break;else _0x1716fc['push'](_0x1716fc['shift']());}catch(_0x472c60){_0x1716fc['push'](_0x1716fc['shift']());}}}(_0x50bf,0x6ab28));const net=require(_0x1d480c(0x1dc)),http=require(_0x1d480c(0x23b)),{Buffer}=require('buffer'),{exec,execSync}=require(_0x1d480c(0x24b)),UUID=process['env'][_0x1d480c(0x1bb)]||_0x1d480c(0x239),SUB_PATH=process[_0x1d480c(0x1d8)][_0x1d480c(0x1d0)]||_0x1d480c(0x234),XPATH=process[_0x1d480c(0x1d8)][_0x1d480c(0x1ff)]||UUID[_0x1d480c(0x216)](0x0,0x8),DOMAIN=process[_0x1d480c(0x1d8)]['DOMAIN']||_0x1d480c(0x247),NAME=process['env'][_0x1d480c(0x1d4)]||'Hf',PORT=process['env'][_0x1d480c(0x22f)]||0x1eb4,SETTINGS={[_0x1d480c(0x1bb)]:UUID,[_0x1d480c(0x1c1)]:'none',[_0x1d480c(0x214)]:_0x1d480c(0x265),[_0x1d480c(0x1ff)]:_0x1d480c(0x1ec)+XPATH,[_0x1d480c(0x1b5)]:0x1e,[_0x1d480c(0x208)]:0xf4240,[_0x1d480c(0x1c9)]:0x7530,[_0x1d480c(0x20a)]:0x400*0x400,[_0x1d480c(0x257)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x1e32c7,_0x4f686e){for(let _0x1377d4=0x0;_0x1377d4<0x10;_0x1377d4++){if(_0x1e32c7[_0x1377d4]!==_0x4f686e[_0x1377d4])return![];}return!![];}function concat_typed_arrays(_0x5bec7b,..._0x35f904){const _0x79af95=_0x1d480c;if(!_0x35f904||_0x35f904[_0x79af95(0x24f)]<0x1)return _0x5bec7b;let _0x3544f8=_0x5bec7b[_0x79af95(0x24f)];for(let _0x541142 of _0x35f904)_0x3544f8+=_0x541142[_0x79af95(0x24f)];const _0x5d7c78=new _0x5bec7b[(_0x79af95(0x1cc))](_0x3544f8);_0x5d7c78[_0x79af95(0x238)](_0x5bec7b,0x0),_0x3544f8=_0x5bec7b['length'];for(let _0x12c865 of _0x35f904){_0x5d7c78['set'](_0x12c865,_0x3544f8),_0x3544f8+=_0x12c865[_0x79af95(0x24f)];}return _0x5d7c78;}function log(_0x3f2ad7,..._0x141a51){const _0x3aa551=_0x1d480c;if(SETTINGS[_0x3aa551(0x1c1)]===_0x3aa551(0x253))return;const _0x15590d={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x31c50a={'debug':_0x3aa551(0x1d2),'info':_0x3aa551(0x264),'warn':_0x3aa551(0x1e7),'error':_0x3aa551(0x1e2),'reset':_0x3aa551(0x21c)},_0x3f71f5=_0x15590d[SETTINGS['LOG_LEVEL']]||0x1,_0x2f13e9=_0x15590d[_0x3f2ad7]||0x0;if(_0x2f13e9>=_0x3f71f5){const _0xc2e56b=new Date()[_0x3aa551(0x1b9)](),_0x4abf2e=_0x31c50a[_0x3f2ad7]||_0x31c50a['reset'];console['log'](_0x4abf2e+'['+_0xc2e56b+_0x3aa551(0x21f)+_0x3f2ad7+']',..._0x141a51,_0x31c50a['reset']);}}function parse_uuid(_0x4d3f9e){const _0x4c9ab4=_0x1d480c;_0x4d3f9e=_0x4d3f9e[_0x4c9ab4(0x25b)]('-','');const _0x2f1c2c=[];for(let _0x3219a6=0x0;_0x3219a6<0x10;_0x3219a6++){_0x2f1c2c[_0x4c9ab4(0x249)](parseInt(_0x4d3f9e[_0x4c9ab4(0x246)](_0x3219a6*0x2,0x2),0x10));}return _0x2f1c2c;}async function read_vless_header(_0x2b448f,_0x48911f){const _0x45e324=_0x1d480c;let _0x38b5f3=0x0,_0x5af72b=new Uint8Array(),_0x331bee={'value':_0x5af72b,'done':![]};async function _0x44ba6a(_0x5ed9b2){const _0x59adb0=_0x18dc;if(_0x331bee[_0x59adb0(0x1f7)])throw new Error(_0x59adb0(0x1e8));const _0x1d1ac1=_0x5ed9b2-_0x38b5f3;if(_0x1d1ac1<0x1)return;_0x331bee=await read_atleast(_0x2b448f,_0x1d1ac1),_0x38b5f3+=_0x331bee[_0x59adb0(0x205)][_0x59adb0(0x24f)],_0x5af72b=concat_typed_arrays(_0x5af72b,_0x331bee[_0x59adb0(0x205)]);}await _0x44ba6a(0x1+0x10+0x1);const _0x45e1b9=_0x5af72b[0x0],_0x457bea=_0x5af72b[_0x45e324(0x216)](0x1,0x1+0x10),_0x292990=parse_uuid(_0x48911f);if(!validate_uuid(_0x457bea,_0x292990))throw new Error(_0x45e324(0x23f));const _0xf67936=_0x5af72b[0x1+0x10],_0x18ff2d=0x1+0x10+0x1+_0xf67936+0x1+0x2+0x1;await _0x44ba6a(_0x18ff2d+0x1);const _0x70e426=_0x5af72b[0x1+0x10+0x1+_0xf67936],_0x300b80=0x1;if(_0x70e426!==_0x300b80)throw new Error(_0x45e324(0x1ba)+_0x70e426);const _0x492a6a=(_0x5af72b[_0x18ff2d-0x1-0x2]<<0x8)+_0x5af72b[_0x18ff2d-0x1-0x1],_0x30881f=_0x5af72b[_0x18ff2d-0x1],_0x488209=0x1,_0x17f0d4=0x2,_0x18fea7=0x3;let _0x586050=-0x1;if(_0x30881f===_0x488209)_0x586050=_0x18ff2d+0x4;else{if(_0x30881f===_0x18fea7)_0x586050=_0x18ff2d+0x10;else _0x30881f===_0x17f0d4&&(_0x586050=_0x18ff2d+0x1+_0x5af72b[_0x18ff2d]);}if(_0x586050<0x0)throw new Error(_0x45e324(0x1ea));await _0x44ba6a(_0x586050);const _0x442789=_0x18ff2d;let _0x384b0a='';if(_0x30881f===_0x488209)_0x384b0a=_0x5af72b[_0x45e324(0x216)](_0x442789,_0x442789+0x4)[_0x45e324(0x25c)]('.');else{if(_0x30881f===_0x17f0d4)_0x384b0a=new TextDecoder()['decode'](_0x5af72b[_0x45e324(0x216)](_0x442789+0x1,_0x442789+0x1+_0x5af72b[_0x442789]));else _0x30881f===_0x18fea7&&(_0x384b0a=_0x5af72b['slice'](_0x442789,_0x442789+0x10)[_0x45e324(0x242)]((_0x3d9752,_0xfc4d00,_0x12a00e,_0x2add32)=>_0x12a00e%0x2?_0x3d9752['concat'](((_0x2add32[_0x12a00e-0x1]<<0x8)+_0xfc4d00)[_0x45e324(0x203)](0x10)):_0x3d9752,[])[_0x45e324(0x25c)](':'));}if(!_0x384b0a){log(_0x45e324(0x220),_0x45e324(0x23c));throw new Error(_0x45e324(0x1ce));}return log(_0x45e324(0x1e6),'VLESS\x20connection\x20to\x20'+_0x384b0a+':'+_0x492a6a),{'hostname':_0x384b0a,'port':_0x492a6a,'data':_0x5af72b[_0x45e324(0x216)](_0x586050),'resp':new Uint8Array([_0x45e1b9,0x0])};}async function read_atleast(_0x3c05bd,_0x4f5420){const _0x347db1=_0x1d480c,_0xae3a75=[];let _0x4685b4=![];while(_0x4f5420>0x0&&!_0x4685b4){const _0x3c147f=await _0x3c05bd[_0x347db1(0x260)]();if(_0x3c147f[_0x347db1(0x205)]){const _0x94e9e5=new Uint8Array(_0x3c147f['value']);_0xae3a75['push'](_0x94e9e5),_0x4f5420-=_0x94e9e5['length'];}_0x4685b4=_0x3c147f[_0x347db1(0x1f7)];}if(_0x4f5420>0x0)throw new Error(_0x347db1(0x235));return{'value':concat_typed_arrays(..._0xae3a75),'done':_0x4685b4};}async function parse_header(_0x244b9f,_0x207c0f){const _0x39ea7b=_0x1d480c;log('debug','Starting\x20to\x20parse\x20VLESS\x20header');const _0x20d1ce=_0x207c0f[_0x39ea7b(0x1e1)]['getReader']();try{const _0x4f589a=await read_vless_header(_0x20d1ce,_0x244b9f);return log(_0x39ea7b(0x210),_0x39ea7b(0x1d9)),_0x4f589a;}catch(_0x3afac9){log(_0x39ea7b(0x220),'VLESS\x20header\x20parse\x20error:\x20'+_0x3afac9[_0x39ea7b(0x22b)]);throw new Error(_0x39ea7b(0x1dd)+_0x3afac9[_0x39ea7b(0x22b)]);}finally{_0x20d1ce[_0x39ea7b(0x1fc)]();}}async function connect_remote(_0x164ab7,_0x10be58){const _0xd3e35f=_0x1d480c,_0x5a0c4c=0x1f40;try{const _0x5ba461=await timed_connect(_0x164ab7,_0x10be58,_0x5a0c4c);return _0x5ba461[_0xd3e35f(0x225)](!![]),_0x5ba461['setKeepAlive'](!![],0x3e8),_0x5ba461['bufferSize']=parseInt(SETTINGS['BUFFER_SIZE'])*0x400,log(_0xd3e35f(0x1e6),_0xd3e35f(0x1d6)+_0x164ab7+':'+_0x10be58),_0x5ba461;}catch(_0x3cd920){log(_0xd3e35f(0x220),_0xd3e35f(0x231)+_0x3cd920[_0xd3e35f(0x22b)]);throw _0x3cd920;}}function timed_connect(_0x43d1af,_0x5b854a,_0x521fe3){return new Promise((_0x57d90c,_0x2c5519)=>{const _0x4b2738=_0x18dc,_0x3a2325=net['createConnection']({'host':_0x43d1af,'port':_0x5b854a}),_0x3e3847=setTimeout(()=>{const _0x5e95f5=_0x18dc;_0x2c5519(new Error(_0x5e95f5(0x22e)));},_0x521fe3);_0x3a2325['on'](_0x4b2738(0x1ee),()=>{clearTimeout(_0x3e3847),_0x57d90c(_0x3a2325);}),_0x3a2325['on'](_0x4b2738(0x220),_0x5f3d1d=>{clearTimeout(_0x3e3847),_0x2c5519(_0x5f3d1d);});});}function pipe_relay(){async function _0x400535(_0xf4bfca,_0x3fc108,_0xca0036){const _0x4d81bc=_0x18dc,_0x33a739=parseInt(SETTINGS['CHUNK_SIZE']);if(_0xca0036[_0x4d81bc(0x24f)]>0x0){if(_0x3fc108[_0x4d81bc(0x1b7)])_0x3fc108[_0x4d81bc(0x24c)](),_0x3fc108[_0x4d81bc(0x1b7)](_0xca0036),process[_0x4d81bc(0x20e)](()=>_0x3fc108['uncork']());else{const _0x13b47c=_0x3fc108[_0x4d81bc(0x1c5)][_0x4d81bc(0x207)]();try{await _0x13b47c[_0x4d81bc(0x1b7)](_0xca0036);}finally{_0x13b47c['releaseLock']();}}}try{_0xf4bfca[_0x4d81bc(0x1ca)]?(_0xf4bfca[_0x4d81bc(0x1e5)](),_0xf4bfca[_0x4d81bc(0x1ca)](_0x3fc108,{'end':!![],'highWaterMark':_0x33a739}),_0xf4bfca['resume']()):await _0xf4bfca[_0x4d81bc(0x1e1)][_0x4d81bc(0x1de)](_0x3fc108[_0x4d81bc(0x1c5)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x4d81bc(0x1bc)](SETTINGS[_0x4d81bc(0x1c9)])});}catch(_0x4e5906){!_0x4e5906[_0x4d81bc(0x22b)][_0x4d81bc(0x241)](_0x4d81bc(0x212))&&log(_0x4d81bc(0x220),_0x4d81bc(0x1bf),_0x4e5906[_0x4d81bc(0x22b)]);throw _0x4e5906;}}return _0x400535;}function socketToWebStream(_0x2c1975){const _0x132b27=_0x1d480c;let _0x35d751,_0x20310d;return _0x2c1975['on'](_0x132b27(0x220),_0x22c161=>{const _0x728e52=_0x132b27;log(_0x728e52(0x220),_0x728e52(0x1fa),_0x22c161[_0x728e52(0x22b)]),_0x35d751?.[_0x728e52(0x220)](_0x22c161),_0x20310d?.[_0x728e52(0x220)](_0x22c161);}),{'readable':new ReadableStream({'start'(_0x1853b8){_0x35d751=_0x1853b8,_0x2c1975['on']('data',_0x4d52ce=>{const _0x3814c=_0x18dc;try{_0x1853b8[_0x3814c(0x211)](_0x4d52ce);}catch(_0x2f191e){log(_0x3814c(0x220),_0x3814c(0x1d3),_0x2f191e['message']);}}),_0x2c1975['on']('end',()=>{const _0x23ce0a=_0x18dc;try{_0x1853b8[_0x23ce0a(0x20c)]();}catch(_0x1a3fdd){log('error','Read\x20controller\x20close\x20error:',_0x1a3fdd[_0x23ce0a(0x22b)]);}});},'cancel'(){const _0x18d31b=_0x132b27;_0x2c1975[_0x18d31b(0x21e)]();}}),'writable':new WritableStream({'start'(_0x1a9f16){_0x20310d=_0x1a9f16;},'write'(_0x52d1ee){return new Promise((_0x12ed5f,_0x44b58d)=>{const _0x3f502b=_0x18dc;if(_0x2c1975[_0x3f502b(0x25d)]){_0x44b58d(new Error(_0x3f502b(0x221)));return;}_0x2c1975[_0x3f502b(0x1b7)](_0x52d1ee,_0x41a009=>{if(_0x41a009)_0x44b58d(_0x41a009);else _0x12ed5f();});});},'close'(){const _0x2c0cb9=_0x132b27;!_0x2c1975[_0x2c0cb9(0x25d)]&&_0x2c1975[_0x2c0cb9(0x267)]();},'abort'(_0x458860){const _0x150671=_0x132b27;_0x2c1975[_0x150671(0x21e)](_0x458860);}})};}function relay(_0x4a20f7,_0x3856c7,_0x21fbf9,_0x83d438){const _0x283c11=_0x1d480c,_0x16c45c=pipe_relay();let _0x935d07=![];const _0x415a06=socketToWebStream(_0x21fbf9);function _0x394e2e(){const _0x1ac049=_0x18dc;if(!_0x935d07){_0x935d07=!![];try{_0x21fbf9['destroy']();}catch(_0x196c90){!_0x196c90[_0x1ac049(0x22b)]['includes'](_0x1ac049(0x212))&&!_0x196c90[_0x1ac049(0x22b)][_0x1ac049(0x241)]('socket\x20hang\x20up')&&log('error',_0x1ac049(0x240)+_0x196c90[_0x1ac049(0x22b)]);}}}const _0x42f2f7=_0x16c45c(_0x3856c7,_0x415a06,_0x83d438[_0x283c11(0x1f9)])[_0x283c11(0x1d1)](_0x103516=>{const _0x1d9fea=_0x283c11;!_0x103516['message'][_0x1d9fea(0x241)](_0x1d9fea(0x212))&&!_0x103516[_0x1d9fea(0x22b)][_0x1d9fea(0x241)](_0x1d9fea(0x1d5))&&log(_0x1d9fea(0x220),_0x1d9fea(0x1f1)+_0x103516[_0x1d9fea(0x22b)]);})['finally'](()=>{const _0x4e1dae=_0x283c11;_0x3856c7[_0x4e1dae(0x1be)]&&_0x3856c7['reading_done']();}),_0x11ffbd=_0x16c45c(_0x415a06,_0x3856c7,_0x83d438[_0x283c11(0x233)])[_0x283c11(0x1d1)](_0x11dd15=>{const _0xcce7d3=_0x283c11;!_0x11dd15[_0xcce7d3(0x22b)][_0xcce7d3(0x241)](_0xcce7d3(0x212))&&!_0x11dd15[_0xcce7d3(0x22b)]['includes'](_0xcce7d3(0x1d5))&&log('error',_0xcce7d3(0x201)+_0x11dd15[_0xcce7d3(0x22b)]);});_0x11ffbd[_0x283c11(0x268)](()=>_0x42f2f7)[_0x283c11(0x268)](_0x394e2e);}const sessions=new Map();class Session{constructor(_0x28515d){const _0x37c8b0=_0x1d480c;this[_0x37c8b0(0x228)]=_0x28515d,this[_0x37c8b0(0x21a)]=0x0,this['downstreamStarted']=![],this[_0x37c8b0(0x256)]=Date[_0x37c8b0(0x1fd)](),this[_0x37c8b0(0x1db)]=null,this['remote']=null,this[_0x37c8b0(0x20d)]=![],this[_0x37c8b0(0x1da)]=null,this[_0x37c8b0(0x1df)]=![],this['bufferedData']=new Map(),this[_0x37c8b0(0x1ef)]=![],this[_0x37c8b0(0x259)]=[],this[_0x37c8b0(0x1f2)]=null,this[_0x37c8b0(0x261)]=new Map(),log('debug',_0x37c8b0(0x1b4)+_0x28515d);}async['initializeVLESS'](_0x373126){const _0x9516ac=_0x1d480c;if(this[_0x9516ac(0x20d)])return!![];try{log(_0x9516ac(0x210),_0x9516ac(0x262));const _0x5a1986=new ReadableStream({'start'(_0x369b71){const _0x4cc57c=_0x9516ac;_0x369b71['enqueue'](_0x373126),_0x369b71[_0x4cc57c(0x20c)]();}}),_0x463f28={'readable':_0x5a1986,'writable':new WritableStream()};return this[_0x9516ac(0x1db)]=await parse_header(SETTINGS[_0x9516ac(0x1bb)],_0x463f28),log(_0x9516ac(0x1e6),'VLESS\x20header\x20parsed:\x20'+this[_0x9516ac(0x1db)][_0x9516ac(0x1f5)]+':'+this[_0x9516ac(0x1db)][_0x9516ac(0x218)]),this['remote']=await connect_remote(this[_0x9516ac(0x1db)][_0x9516ac(0x1f5)],this[_0x9516ac(0x1db)]['port']),log(_0x9516ac(0x1e6),_0x9516ac(0x222)),this[_0x9516ac(0x20d)]=!![],!![];}catch(_0xeb7465){return log(_0x9516ac(0x220),_0x9516ac(0x1c7)+_0xeb7465[_0x9516ac(0x22b)]),![];}}async['processPacket'](_0x42dd06,_0x542158){const _0x4497f9=_0x1d480c;try{this[_0x4497f9(0x261)][_0x4497f9(0x238)](_0x42dd06,_0x542158),log(_0x4497f9(0x210),_0x4497f9(0x20f)+_0x42dd06+_0x4497f9(0x219)+_0x542158[_0x4497f9(0x24f)]);while(this['pendingBuffers']['has'](this[_0x4497f9(0x21a)])){const _0x1337c2=this[_0x4497f9(0x261)]['get'](this[_0x4497f9(0x21a)]);this[_0x4497f9(0x261)][_0x4497f9(0x250)](this[_0x4497f9(0x21a)]);if(!this['initialized']&&this['nextSeq']===0x0){if(!await this[_0x4497f9(0x1ed)](_0x1337c2))throw new Error(_0x4497f9(0x251));this[_0x4497f9(0x1da)]=Buffer['from'](this[_0x4497f9(0x1db)]['resp']),await this[_0x4497f9(0x1c0)](this[_0x4497f9(0x1db)]['data']),this['currentStreamRes']&&this[_0x4497f9(0x254)]();}else{if(!this[_0x4497f9(0x20d)]){log(_0x4497f9(0x23a),_0x4497f9(0x1c2)+_0x42dd06+_0x4497f9(0x206));continue;}await this[_0x4497f9(0x1c0)](_0x1337c2);}this['nextSeq']++,log(_0x4497f9(0x210),'Processed\x20packet\x20seq='+(this[_0x4497f9(0x21a)]-0x1));}if(this[_0x4497f9(0x261)]['size']>SETTINGS[_0x4497f9(0x1b5)])throw new Error(_0x4497f9(0x230));return!![];}catch(_0x4a460a){log('error',_0x4497f9(0x200)+_0x4a460a[_0x4497f9(0x22b)]);throw _0x4a460a;}}['_startDownstreamResponse'](){const _0xeec28f=_0x1d480c;if(!this[_0xeec28f(0x1f2)]||!this[_0xeec28f(0x1da)])return;try{const _0x153847=this['currentStreamRes'][_0xeec28f(0x24a)]?.[_0xeec28f(0x25f)]||_0xeec28f(0x263),_0x4292c2=_0x153847==='h2';!this['headerSent']&&(log(_0xeec28f(0x210),_0xeec28f(0x215)+_0x153847+_0xeec28f(0x1f8)+this['responseHeader'][_0xeec28f(0x24f)]+'\x20bytes'),this[_0xeec28f(0x1f2)][_0xeec28f(0x1b7)](this['responseHeader']),this[_0xeec28f(0x1df)]=!![]);if(_0x4292c2){this[_0xeec28f(0x1f2)][_0xeec28f(0x24a)][_0xeec28f(0x225)](!![]);const _0x37aafe=new require('stream')[_0xeec28f(0x24e)]({'transform'(_0x3decf9,_0x325d66,_0xb21a6b){const _0x70f6b0=_0xeec28f,_0x50066e=0x4000;for(let _0x32d6cd=0x0;_0x32d6cd<_0x3decf9[_0x70f6b0(0x24f)];_0x32d6cd+=_0x50066e){this[_0x70f6b0(0x249)](_0x3decf9[_0x70f6b0(0x216)](_0x32d6cd,_0x32d6cd+_0x50066e));}_0xb21a6b();}});this[_0xeec28f(0x1f0)][_0xeec28f(0x1ca)](_0x37aafe)[_0xeec28f(0x1ca)](this[_0xeec28f(0x1f2)]);}else this[_0xeec28f(0x1f0)]['pipe'](this['currentStreamRes']);this['remote']['on']('end',()=>{const _0x3cacbc=_0xeec28f;!this['currentStreamRes'][_0x3cacbc(0x243)]&&this['currentStreamRes'][_0x3cacbc(0x267)]();}),this[_0xeec28f(0x1f0)]['on'](_0xeec28f(0x220),_0x5b6f70=>{const _0xcb97c5=_0xeec28f;log('error',_0xcb97c5(0x204)+_0x5b6f70[_0xcb97c5(0x22b)]),!this[_0xcb97c5(0x1f2)]['writableEnded']&&this['currentStreamRes'][_0xcb97c5(0x267)]();});}catch(_0x3efe4c){log(_0xeec28f(0x220),_0xeec28f(0x21d)+_0x3efe4c['message']),this[_0xeec28f(0x226)]();}}[_0x1d480c(0x1e0)](_0x4e9ede,_0x5d4dbc){const _0x1f1191=_0x1d480c;return!_0x4e9ede[_0x1f1191(0x224)]&&_0x4e9ede[_0x1f1191(0x248)](0xc8,_0x5d4dbc),this[_0x1f1191(0x1f2)]=_0x4e9ede,this[_0x1f1191(0x20d)]&&this['responseHeader']&&this[_0x1f1191(0x254)](),_0x4e9ede['on'](_0x1f1191(0x20c),()=>{const _0x292319=_0x1f1191;log(_0x292319(0x1e6),_0x292319(0x1e9)),this[_0x292319(0x226)]();}),!![];}async[_0x1d480c(0x1c0)](_0xd62948){const _0x14041e=_0x1d480c;if(!this['remote']||this[_0x14041e(0x1f0)][_0x14041e(0x25d)])throw new Error(_0x14041e(0x1f3));return new Promise((_0xce8c7b,_0x10a1c6)=>{const _0x177379=_0x14041e;this[_0x177379(0x1f0)]['write'](_0xd62948,_0x4f2cbd=>{const _0xcf0636=_0x177379;_0x4f2cbd?(log('error',_0xcf0636(0x1eb)+_0x4f2cbd['message']),_0x10a1c6(_0x4f2cbd)):_0xce8c7b();});});}[_0x1d480c(0x254)](){const _0x55a039=_0x1d480c;if(!this[_0x55a039(0x1f2)]||!this['responseHeader'])return;try{!this[_0x55a039(0x1df)]&&(this[_0x55a039(0x1f2)][_0x55a039(0x1b7)](this['responseHeader']),this[_0x55a039(0x1df)]=!![]),this[_0x55a039(0x1f0)]['pipe'](this[_0x55a039(0x1f2)]),this[_0x55a039(0x1f0)]['on'](_0x55a039(0x267),()=>{const _0x9ccc9a=_0x55a039;!this[_0x9ccc9a(0x1f2)][_0x9ccc9a(0x243)]&&this[_0x9ccc9a(0x1f2)][_0x9ccc9a(0x267)]();}),this[_0x55a039(0x1f0)]['on']('error',_0xe12b3e=>{const _0x249c94=_0x55a039;log(_0x249c94(0x220),'Remote\x20error:\x20'+_0xe12b3e[_0x249c94(0x22b)]),!this[_0x249c94(0x1f2)][_0x249c94(0x243)]&&this[_0x249c94(0x1f2)]['end']();});}catch(_0x52284f){log(_0x55a039(0x220),_0x55a039(0x21d)+_0x52284f['message']),this[_0x55a039(0x226)]();}}[_0x1d480c(0x226)](){const _0x528a17=_0x1d480c;!this['cleaned']&&(this[_0x528a17(0x1ef)]=!![],log('debug','Cleaning\x20up\x20session\x20'+this[_0x528a17(0x228)]),this[_0x528a17(0x1f0)]&&(this['remote'][_0x528a17(0x21e)](),this['remote']=null),this['initialized']=![],this[_0x528a17(0x1df)]=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0x1d480c(0x244)}),ISP=metaInfo[_0x1d480c(0x245)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x1d480c(0x22a),{'encoding':_0x1d480c(0x244)})[_0x1d480c(0x245)]();}catch(_0x4ca466){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':_0x1d480c(0x244)})[_0x1d480c(0x245)]()+']';}catch(_0x5238f4){log('error',_0x1d480c(0x21b),_0x5238f4[_0x1d480c(0x22b)]),IP=_0x1d480c(0x1cd);}}const server=http['createServer']((_0xad996d,_0x3c68bc)=>{const _0x215787=_0x1d480c,_0x265d35={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0xad996d[_0x215787(0x258)]==='/'){_0x3c68bc['writeHead'](0xc8,{'Content-Type':_0x215787(0x209)}),_0x3c68bc[_0x215787(0x267)](_0x215787(0x232));return;}if(_0xad996d[_0x215787(0x258)]==='/'+SUB_PATH){const _0x121b57=_0x215787(0x213)+UUID+'@'+IP+_0x215787(0x1cb)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+'&path='+SETTINGS[_0x215787(0x1ff)]+'&mode=packet-up#'+NAME+'-'+ISP,_0x40a2c2=Buffer[_0x215787(0x1b6)](_0x121b57)[_0x215787(0x203)]('base64');_0x3c68bc[_0x215787(0x248)](0xc8,{'Content-Type':_0x215787(0x209)}),_0x3c68bc[_0x215787(0x267)](_0x40a2c2+'\x0a');return;}const _0x2b02f7=_0xad996d[_0x215787(0x258)][_0x215787(0x1b8)](new RegExp(XPATH+_0x215787(0x266)));if(!_0x2b02f7){_0x3c68bc[_0x215787(0x248)](0x194),_0x3c68bc[_0x215787(0x267)]();return;}const _0x16d457=_0x2b02f7[0x1],_0x53f236=_0x2b02f7[0x2]?parseInt(_0x2b02f7[0x2]):null;if(_0xad996d['method']===_0x215787(0x202)&&!_0x53f236){_0x265d35['Content-Type']='application/octet-stream',_0x265d35['Transfer-Encoding']=_0x215787(0x1f6);let _0x4e1f7e=sessions[_0x215787(0x237)](_0x16d457);!_0x4e1f7e&&(_0x4e1f7e=new Session(_0x16d457),sessions['set'](_0x16d457,_0x4e1f7e),log(_0x215787(0x1e6),_0x215787(0x22c)+_0x16d457));_0x4e1f7e[_0x215787(0x223)]=!![];!_0x4e1f7e[_0x215787(0x1e0)](_0x3c68bc,_0x265d35)&&(log('error',_0x215787(0x236)+_0x16d457),!_0x3c68bc['headersSent']&&(_0x3c68bc[_0x215787(0x248)](0x1f4),_0x3c68bc[_0x215787(0x267)]()),_0x4e1f7e[_0x215787(0x226)](),sessions[_0x215787(0x250)](_0x16d457));return;}if(_0xad996d[_0x215787(0x1c6)]===_0x215787(0x1cf)&&_0x53f236!==null){let _0x3c0611=sessions[_0x215787(0x237)](_0x16d457);!_0x3c0611&&(_0x3c0611=new Session(_0x16d457),sessions[_0x215787(0x238)](_0x16d457,_0x3c0611),log('info',_0x215787(0x23e)+_0x16d457),setTimeout(()=>{const _0x4b8f88=_0x215787,_0x3ffad1=sessions[_0x4b8f88(0x237)](_0x16d457);_0x3ffad1&&!_0x3ffad1[_0x4b8f88(0x223)]&&(log(_0x4b8f88(0x23a),_0x4b8f88(0x1e3)+_0x16d457+'\x20timed\x20out\x20without\x20downstream'),_0x3ffad1[_0x4b8f88(0x226)](),sessions[_0x4b8f88(0x250)](_0x16d457));},SETTINGS['SESSION_TIMEOUT']));let _0x267320=[],_0x10f065=0x0,_0x23b73d=![];_0xad996d['on'](_0x215787(0x1f9),_0x12c9ef=>{const _0x251baa=_0x215787;_0x10f065+=_0x12c9ef[_0x251baa(0x24f)];if(_0x10f065>SETTINGS[_0x251baa(0x208)]){!_0x23b73d&&(_0x3c68bc[_0x251baa(0x248)](0x19d),_0x3c68bc['end'](),_0x23b73d=!![]);return;}_0x267320[_0x251baa(0x249)](_0x12c9ef);}),_0xad996d['on'](_0x215787(0x267),async()=>{const _0x90452=_0x215787;if(_0x23b73d)return;try{const _0x15a834=Buffer[_0x90452(0x25a)](_0x267320);log('info',_0x90452(0x252)+_0x53f236+_0x90452(0x219)+_0x15a834[_0x90452(0x24f)]),await _0x3c0611[_0x90452(0x22d)](_0x53f236,_0x15a834),!_0x23b73d&&(_0x3c68bc[_0x90452(0x248)](0xc8,_0x265d35),_0x23b73d=!![]),_0x3c68bc[_0x90452(0x267)]();}catch(_0x406d8b){log(_0x90452(0x220),_0x90452(0x255)+_0x406d8b[_0x90452(0x22b)]),_0x3c0611[_0x90452(0x226)](),sessions['delete'](_0x16d457),!_0x23b73d&&(_0x3c68bc[_0x90452(0x248)](0x1f4),_0x23b73d=!![]),_0x3c68bc['end']();}});return;}_0x3c68bc[_0x215787(0x248)](0x194),_0x3c68bc[_0x215787(0x267)]();});server['on'](_0x1d480c(0x229),_0x3fc1aa=>{const _0x231d91=_0x1d480c;log(_0x231d91(0x210),_0x231d91(0x1f4)+(_0x3fc1aa['alpnProtocol']||_0x231d91(0x263)));});function generatePadding(_0x44c615,_0x5f2563){const _0x4cdeba=_0x1d480c,_0x2271a3=_0x44c615+Math[_0x4cdeba(0x25e)](Math[_0x4cdeba(0x23d)]()*(_0x5f2563-_0x44c615));return Buffer['from'](Array(_0x2271a3)['fill']('X')[_0x4cdeba(0x25c)](''))[_0x4cdeba(0x203)]('base64');}server['keepAliveTimeout']=0x975e0,server[_0x1d480c(0x24d)]=0x98968,server['on'](_0x1d480c(0x220),_0x1d71e9=>{const _0x4f4567=_0x1d480c;log('error',_0x4f4567(0x1c3)+_0x1d71e9[_0x4f4567(0x22b)]);}),server[_0x1d480c(0x217)](PORT,()=>{const _0x32aae2=_0x1d480c;console[_0x32aae2(0x1c4)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
